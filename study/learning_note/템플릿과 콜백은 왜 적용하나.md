# 템플릿과 콜백은 왜 적용하나?

Spring에서 템플릿과 콜백을 사용하는 이유는 **코드의 재사용성을 높이고, 유연한 설계를 가능하게 하며, 코드의 중복을 줄이는 데 있다**고 할 수 있습니다. 지금 작성한 코드는 템플릿 메서드 패턴을 활용해 API 호출을 표준화하고, 콜백을 통해 각 호출에 맞는 로직을 유연하게 적용할 수 있도록 설계되었습니다. 각각의 장점을 설명해 볼게요.

------

### **1. 왜 템플릿과 콜백을 적용했는가?**

#### **1-1. 템플릿 메서드 패턴**

`runApiForExRate` 메서드는 API 호출 과정을 다음과 같은 공통 흐름으로 정의했습니다:

1. **URI 생성**
2. **API 호출 (execute 메서드)**
3. **응답 처리 (extract 메서드)**

이 흐름은 대부분의 API 호출에서 공통적으로 나타나는 패턴입니다. 이를 하나의 템플릿으로 묶어두면, 새로운 API를 추가하거나 수정할 때 **공통 로직을 재사용할 수 있어 코드 중복을 줄이고 유지보수가 용이**해집니다.

#### **1-2. 콜백 적용**

템플릿 메서드 패턴에서 **변화가 필요한 부분**은 콜백 인터페이스를 활용해 추상화했습니다:

- `ApiExecutor`: API 호출 방식을 추상화 (예: HTTP 호출, 다른 프로토콜 추가 가능)
- `ExRateExtractor`: API 응답을 파싱하는 방식 추상화 (예: JSON, XML 등 다양한 응답 포맷 처리 가능)

콜백을 사용하면, 구체적인 구현에 종속되지 않고 **인터페이스에 의존**하도록 설계되므로 OCP(개방-폐쇄 원칙)를 준수합니다.

------

### **2. 얻는 이점**

#### **2-1. 코드 재사용성과 확장성**

- API 호출 과정의 공통적인 부분은 `runApiForExRate` 템플릿 메서드에 포함되어 재사용할 수 있습니다.

- 새로운 API를 추가할 때, 

  ```
  ApiExecutor
  ```

  와 

  ```
  ExRateExtractor
  ```

  의 구현체만 교체하면 되므로 코드 수정 없이 확장이 가능합니다.

  - 예: 다른 통화 정보를 얻고 싶다면 `ExRateExtractor` 구현체만 변경하면 됩니다.

#### **2-2. 유지보수 용이성**

- 로직이 변경되더라도 특정 부분만 수정하면 되므로 코드 수정이 국소화됩니다.
  - 예: API 호출 방법 변경 시 `ApiExecutor`만 수정하면 다른 로직에 영향을 주지 않습니다.

#### **2-3. 테스트 용이성**

- ```
  ApiExecutor
  ```

  나 

  ```
  ExRateExtractor
  ```

  를 Mock으로 대체하여 유닛 테스트를 쉽게 작성할 수 있습니다.

  - 예: 실제 API 호출 없이 테스트용 데이터를 전달하여 응답 처리 로직만 검증 가능.

#### **2-4. 다양한 요구사항에 대응 가능**

- 여러 API를 호출해야 하는 시스템에서는 각 API마다 서로 다른 요청/응답 방식이 존재할 수 있습니다. 템플릿과 콜백을 사용하면 공통 로직과 API별 변형된 로직을 분리할 수 있어 이런 다양성에 유연하게 대응할 수 있습니다.

------

### **3. 설계 원칙과 관련성**

이 코드는 **SOLID 원칙** 중 다음 원칙들을 잘 따르고 있습니다:

- **단일 책임 원칙 (SRP)**: 각 클래스는 자신만의 역할을 가짐 (`ApiExecutor`, `ExRateExtractor` 등).
- **개방-폐쇄 원칙 (OCP)**: 템플릿은 수정하지 않고 새로운 요구사항(새로운 API, 새로운 응답 처리 방식)에 대해 확장 가능.
- **의존 역전 원칙 (DIP)**: `runApiForExRate`는 구체적인 클래스 대신 인터페이스에 의존 (`ApiExecutor`, `ExRateExtractor`).

------

### **4. 요약**

템플릿과 콜백을 적용한 이유는 **API 호출 과정을 표준화하고, 변화하는 부분(호출 방식, 응답 처리)을 추상화하여 유연성과 재사용성을 높이기 위함**입니다. 이를 통해:

1. **코드 중복 제거**
2. **확장 가능성 증가**
3. **유지보수 및 테스트 용이성 확보**

이런 장점이 있기 때문에 Spring뿐만 아니라 다양한 Java 기반 설계에서 템플릿과 콜백이 널리 사용됩니다.