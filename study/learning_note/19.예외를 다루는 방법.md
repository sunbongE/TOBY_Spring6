# 예외를 다루는 방법



## 예외가 발생하면

- 예외 상황을 복구해서 정상적인 흐름으로 전환할 수 있는가
  - 재시도
  - 대안
    - 환율정보 가져오는 api에 장애가 발생할때를 대비해
      2가지를 준비
- 버그인가
  - 예외가 발생한 코드의 버그인가
  - 클라의 버그인가
- 제어할 수 없는 예외인가



## 예외의 추상화와 전환

- 사용 기술에 따라 같은 문제에 대해 다른 종류의 예외 발생
- 적절한 예외 추상화와 예외 번역이 필요



---

# DataAccessException과 예외 추상화

## JDBC SQLException

- JDBC를 기반으로 하는 모든 기술에서 발생하는 예외
- JDBC, MyBatis, JPA
- DB의 에러코드에 의존하거나, 데이터 기술에 의존적인 예외처리 코드



## DataAccessException

- DB의 에러코드와 데이터 액세스 기술에 독립적인 예외 구조
- 적절한 예외 번역 도구를 제공.



---

## 정리

계속 언급되는 중요한 것은 결국 확장성이 높고, 기술이 변했을 때 코드에 영향이 있는 것을 최소화 하자는 것 같다.

그래서 스프링이 여러 예외를 추상화한 것을 우리는 사용하면서, 사용하는 기술 JPA -> MyBatis 으로 변했을 때 동일한 예외처리를 할 수 있게 해야한다는 것 같다.
참고로, 같은 상황에서 예외라도 기술마다 발생하는 예외가 다를 수 있다고 했다. 때문에 잘 만들어둔 추상화된 예외를 적절히 사용해보자.



---

# 자주 사용하는 예외 종류와 설명

스프링 개발자라면 반드시 알아두어야 할 주요 추상화 예외 종류를 아래 표로 정리하였습니다. 이 예외들은 모두 `org.springframework.dao.DataAccessException`을 기반으로 하며, 데이터 접근 계층에서 발생할 수 있는 다양한 문제를 기술과 무관하게 처리할 수 있도록 추상화합니다.

| **예외 클래스**                              | **설명**                                                     | **발생 상황**                                                |
| -------------------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| **`DataAccessException`**                    | 모든 데이터 접근 예외의 최상위 추상화 클래스                 | 데이터 접근 중 발생하는 일반적인 예외                        |
| **`DataIntegrityViolationException`**        | 데이터 무결성 제약 조건 위반 (유니크 제약, 외래 키 제약 등)  | - 중복 키 삽입 - 외래 키 제약 위반 - NULL 불허 필드에 NULL 값 삽입 |
| **`DuplicateKeyException`**                  | 유니크 키 위반과 같은 중복 키로 인한 데이터 삽입 실패        | - 이미 존재하는 키를 중복으로 삽입                           |
| **`EmptyResultDataAccessException`**         | 예상한 결과가 없거나 1건을 기대했으나 여러 건의 결과가 반환된 경우 | - `queryForObject` 호출 시 결과가 없거나 - 결과가 여러 건인 경우 |
| **`IncorrectResultSizeDataAccessException`** | 쿼리 결과 크기가 예상과 다른 경우                            | - 단일 결과를 기대했으나 다중 결과가 반환됨                  |
| **`QueryTimeoutException`**                  | 데이터베이스 쿼리가 지정된 시간 내에 완료되지 못한 경우      | - 실행 시간이 긴 쿼리가 타임아웃 조건을 초과                 |
| **`CannotAcquireLockException`**             | 데이터베이스 락 획득 실패                                    | - 락 대기가 초과된 경우                                      |
| **`DeadlockLoserDataAccessException`**       | 데이터베이스 데드락 감지 시 발생                             | - 여러 트랜잭션 간 자원 충돌로 데드락이 발생                 |
| **`InvalidDataAccessApiUsageException`**     | 스프링 데이터 접근 API 사용 방법이 잘못된 경우               | - JPA 엔터티 매핑 오류 - `null` 전달 또는 API 잘못된 호출    |
| **`OptimisticLockingFailureException`**      | 낙관적 락 실패로 인해 데이터 갱신 충돌                       | - JPA 또는 Hibernate의 낙관적 락 사용 시 버전 불일치         |
| **`DataAccessResourceFailureException`**     | 데이터베이스 연결 실패 또는 자원 접근 실패                   | - 데이터베이스 서버가 다운된 경우 - 네트워크 문제            |
| **`UncategorizedDataAccessException`**       | 특정 예외로 분류되지 않은 예외를 포괄                        | - 스프링이 알 수 없는 데이터 접근 예외가 발생                |